{"version":3,"file":"chunk_dialog.js","mappings":"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","sources":["webpack://@aamasri/dialog/./src/dialog.js"],"sourcesContent":["/*\n * dialog.js\n * (c) 2020 Ananda Masri\n * Released under the MIT license\n * auro.technology/open-source/dialog\n */\n\n\nimport './dialog.styl';\nimport closeIcon from './close-icon.svg';\nimport fullscreenIcon from './fullscreen-icon.svg';\n\n\n// module scope vars\nconst debug = false;\nlet loadUrlBusy;\nlet dialogCount = 0;\nlet $body;\nlet $window;\n\n\n/** launches a popup dialog configured by an options object\n *\n * @param {Object} options\n * @param {string|undefined} options.title - (optional) dialog title, source element title attribute (missing title => chromeless dialog)\n * @param {string|object|undefined} options.source - the content source: html content, selector, url(GET encoded data), or element\n * @param {string|undefined } options.fragment - (optional) selector by which to isolate a portion of the source HTML\n * @param {boolean|undefined} options.modal - (default false) page background dimming\n * @param {boolean|undefined} options.iframe - (default false) if the source is an url, whether to load it in an iFrame (adds a full-screen link to the source url)\n * @param {string|undefined} options.fullscreenUrl - (optional) forces a full-screen button (or for the case that fullscreen url differs from the source url)\n * @param {boolean|undefined} options.replace - (default true) whether to close any existing dialogs or layer up\n * @param {boolean|undefined} options.persistent - (default false) whether ESC/blur automatically closes the dialog\n * @param {function|string|undefined} options.onClose - (optional) function or eval(string) callback to execute after dialog dismissed\n * @param {string|undefined} options.classes - (optional) classes to apply to the dialog\n * @param {string|undefined} options.attributes - (optional) attributes to apply to the dialog\n *\n * @returns {Promise}\n */\nconst open = async function(options) {\n    options = options || {};\n\n    if (debug) console.debug('dialog.open invoked with options', options);\n\n    // lazy load dependencies\n    if (window.jQuery === undefined) {\n        window.jQuery = await import(/* webpackChunkName: \"jquery\" */ 'jquery');\n        window.jQuery = window.jQuery.default;\n    }\n\n    if (debug) console.debug('jQuery loaded', typeof window.jQuery);\n\n    if (window.anime === undefined) {\n        window.anime = await import(/* webpackChunkName: \"anime\" */ 'animejs/lib/anime.es.js');\n        window.anime = window.anime.default;\n    }\n\n    if (debug) console.debug('anime.js loaded', typeof window.anime);\n\n    const domUtils = await import(/* webpackChunkName: \"dom-utils\" */ '@aamasri/dom-utils');\n\n    if (debug) console.debug('dom-utils loaded', typeof domUtils);\n\n    $body = $body || domUtils.$cache().$body;\n    $window = $window || domUtils.$cache().$window;\n\n    if (!options.title && !options.source) {\n        options.title = 'Dialog Cheat Sheet';\n        options.source = usageInstructions;\n    }\n\n    // variables for constructing the dialog UI component\n\n    // globalize the dialog count (so that it's not reset on each dialog load) resulting in duplicate dialog ids\n    if (dialogCount === 0) {\n        let existingDialogs = document.querySelectorAll('.dialog-box');\n        if (existingDialogs.length) {\n            existingDialogs = [ ...existingDialogs ]; // converts NodeList to Array\n            existingDialogs.forEach(dialog => {\n                const count = parseInt(dialog.id.replace(/[^0-9]+/, ''));\n                if (count > dialogCount)\n                    dialogCount = count;\n\n                console.log(`found exisiting dialog #${dialog.id} --> dialogCount=${dialogCount} ${count}`);\n            });\n        }\n    }\n\n    let dialogId = `dialog-${++dialogCount}`;\n    let dialogBody;\n    let dialogTitle = options.title || '';\n\n    // autodetect if specified source is an url (ie starts with \"http\" or \"/\")\n    const sourceIsUrl = typeof options.source === 'string' && (/^https?:\\/\\/[a-z]+/.test(options.source) || /^\\/[a-z]+/.test(options.source));\n\n    let useIframe = options.iframe && sourceIsUrl || false;\n    if (useIframe)\n        dialogBody = `<iframe src=\"${options.source}\"></iframe>`;\n\n    // selector or raw content?\n    if (!sourceIsUrl) {\n        if (debug) console.debug(`not url`);  // non-url source\n\n        try {\n            const sourceElement = document.querySelector(options.source);\n            if (debug) console.debug('source is an element');\n\n            if (sourceElement) {\n                dialogBody = sourceElement.innerHTML;\n                dialogTitle = dialogTitle || elementTitle(sourceElement) || '';\n            }\n\n            if (debug) console.debug(`dialog title:${dialogTitle} \\n\\n body:${dialogBody}`);\n        } catch (error) {\n            // ignore error - just means options.source isn't a selector\n            if (debug) console.debug(`source \"${options.source}\" is not a selector`);\n        }\n\n        dialogBody = dialogBody || options.source || '';\n    }\n\n    options.replace = typeof options.replace === 'undefined' || !!options.replace;  // default true\n    if (options.replace)\n        closeAll();     // close all existing dialogs\n\n    // build the dialog UI\n    const modalDiv = options.modal ? `<div class=\"dialog-modal\" data-for=\"${dialogId}\"></div>` : '';\n\n    const urlData = (useIframe || options.fullscreenUrl) ? `data-url=\"${options.fullscreenUrl || options.source}\"` : '';\n    const createdData = `data-created=\"${Date.now()}\"`;\n    const fullScreenIcon = (useIframe || options.fullscreenUrl) ? `<span class=\"icon-fullscreen\" title=\"Fullscreen\">${fullscreenIcon}</span>` : '';\n\n    let classes = [];\n    if (useIframe) classes.push('has-iframe');\n    if (!dialogTitle) classes.push('chromeless');\n    if (options.persistent) classes.push('persistent');\n    if (options.classes && typeof options.classes === 'string') classes.push(options.classes);\n\n    const attributes = options.attributes || '';\n\n    let $dialog = jQuery(`${modalDiv}\n                        <div id=\"${dialogId}\" class=\"dialog-box ${classes.join(' ')}\" ${attributes} ${createdData} ${urlData}>\n                            <div class=\"dialog-header\">\n                                <div class=\"title\">${dialogTitle}</div>\n                                <div class=\"icons\">\n                                    ${fullScreenIcon}\n                                    <span class=\"icon-close\">${closeIcon}</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"dialog-body\">\n                                ${(dialogBody || '<div class=\"dialog-loader\">Loading <div class=\"dialog-progress-bar\"></div></div>')}\n                            </div>\n                        </div>`);\n\n    $dialog.appendTo($body);\n\n    // apply z-index to modal underlay and dialog box\n    const onTop = domUtils.onTopZIndex();\n    if (onTop)\n        $dialog.css('z-index', onTop);\n\n    let $modal;\n    if (options.modal) {\n        $modal = $body.find(`data-url[${dialogId}]`);\n        $dialog = $body.find(`#${dialogId}`);    // exclude the modal overlay div\n    }\n\n    if (debug) console.debug(`dialog ${dialogId} appended to body`, $dialog.length);\n\n\n    initDialogListeners();   // dialog events: fullscreen, close(ESC, blur, close icon)\n\n    if (options.onClose)\n        bindCloseCallback($dialog, options.onClose);\n\n    let openAnimation = openAnimateDialog($dialog);\n\n    // fetch the url content\n    if (sourceIsUrl && !useIframe) {\n        // give urls a chance to load (with a timeout)\n        if (loadUrlBusy) {\n            console.warn('dialog cancelled because another dialog is loading');\n            if ($modal)\n                $modal.remove();\n\n            $dialog.remove();\n            return;\n        }\n\n        loadUrlBusy = window.setTimeout(() => {\n            loadUrlBusy = false;\n        }, 2000);\n\n\n        // CORS compatible request (allows non SSL sites to access content from SSL sites)\n        // with progress indicator\n        const $progressBar = $dialog.find('.dialog-progress-bar');\n        try {\n            dialogBody = await jQuery.ajax({\n                url: options.source,\n                xhr: () => {\n                    $progressBar.css('width', '40%');\n                    const xhr = new window.XMLHttpRequest();\n                    xhr.addEventListener('progress', evt => {\n                        if (evt.lengthComputable) {\n                            const loadProgress = evt.loaded / evt.total;\n                            $progressBar.css('width', `${loadProgress * 100}%`);\n                        }\n                    }, false);\n                    return xhr;\n                },\n            });\n\n            // mimics jQuery.load fragment functionality: isolate the specified selector within the returned content\n            if (options.fragment)\n                dialogBody = jQuery(dialogBody).find(options.fragment).html();\n\n            if (dialogBody.includes('<head')) {\n                dialogBody = `<iframe src=\"${options.source}\"></iframe>`;   // optimally the developer would have specified this option in the first place\n                $dialog.addClass('has-iframe');\n                console.warn('package @aamasri/dialog recommends using the \"iframe\" or \"fragment\" options when the loading a full HTML document!');\n            }\n\n        } catch (error) {\n            if (error.responseText)\n                dialogBody = error.responseText;    // backend error message\n            else if (error.statusText)              // backend error status eg. 404 Not Found\n                dialogBody = `Loading url ${options.source} failed with \"${error.statusText}\"`;\n            else\n                dialogBody = 'Loading url ${options.source} failed!';      // whoops - we've got no idea what went wrong\n        }\n\n        // allows us to test the url loading animation\n        if (debug) await new Promise(r => setTimeout(r, 3000));\n\n        loadUrlBusy = false;\n        $dialog.find('.dialog-body').html(dialogBody);\n\n        if (debug) console.debug('replace content:', $dialog.find('.dialog-body').html());\n\n        // animate dialog open again as it's remotely loaded content is probably bigger\n        openAnimation.pause();\n        openAnimation = openAnimateDialog($dialog);\n    }\n\n    await openAnimation.finished;   // resolved on animation complete\n    $dialog.find('.dialog-header .icons svg').fadeIn();     // this is really just to get Firefox to re-render them properly\n    return $dialog[0];  // enables dialog element to be manipulated by invoker\n}\n\n\n\nfunction openAnimateDialog($dialog) {\n    if (debug) console.debug(`openAnimateDialog `, $dialog[0].id);\n\n    // dialog sizing\n    const dialogWidth = $dialog.width();\n    const dialogHeight = $dialog.height();\n    const dialogArea = dialogHeight * dialogWidth;\n    const windowWidth = $window.width();\n    const windowHeight = $window.height();\n    const windowArea = windowHeight * windowWidth;\n\n    const large = dialogArea/windowArea > 0.3;\n    if (large)\n        $dialog.addClass('large');\n\n    if (debug) console.debug(`area`, dialogArea/windowArea);\n\n    // focus/select first input element of any form content\n    const formInput = document.querySelector(`#${$dialog[0].id} .dialog-body input`);\n    if (formInput) {\n        formInput.focus();\n        formInput.select();\n    }\n\n    const wide = (dialogWidth / windowWidth) > 0.8;   // avoid overshooting the viewport (hence 2 animations)\n    const easing = wide || large ? 'cubicBezier(0.190, 1.000, 0.400, 1.000)' : 'easeOutElastic(1, 0.6)';\n\n    if (debug) console.debug(`wide ${wide}`, dialogWidth / windowWidth);\n\n    // launch animation\n    const animeConfig = {\n        targets: $dialog[0],\n        translateX: [ '-50%', '-50%' ],\n        translateY: [ '-50%', '-50%' ],\n        scale: [ 0, 1 ],\n        duration: 500,\n        easing: easing\n    };\n\n    return anime(animeConfig);   // run open animation\n}\n\n\nfunction executeCallback(callback) {\n    switch (typeof (callback)) {\n        case 'function':\n            callback();\n            return;\n\n        case 'string':\n            try {\n                eval(callback);\n            } catch (error) {\n                console.error('close callback failed with', error);\n            }\n    }\n}\n\n\n\n/** close/destroy all popup dialogs\n * @returns {void}\n */\nconst closeAll = function() {\n    const dialogs = getAllDialogs();\n    const modals = getAllModals();\n\n    if (dialogs.length)\n        dialogs.forEach((dialog) => {\n            dialog.remove();\n        });\n\n    if (modals.length)\n        modals.forEach((modal) => {\n            modal.remove();\n        });\n}\n\n\n/** close/destroy the topmost dialog\n * @returns {void}\n */\nconst closeLast = function() {\n    const dialogs = getAllDialogs();\n    if (dialogs.length) {\n        const lastDialog = dialogs[dialogs.length - 1];\n\n        // persistent dialogs don't close on blur\n        if (!lastDialog.classList.contains('persistent'))\n            close(lastDialog);\n    }\n}\n\n\n/** close/destroy the specified popup dialog\n * @param {object|jQuery|HTMLElement|Element } dialog\n * @returns {void}\n */\nconst close = function(dialog) {\n    const $dialog = jQuery(dialog).closest('.dialog-box');\n    if (!$dialog.length)\n        return;\n\n    dialog = $dialog[0];\n\n    if (debug) console.debug(`  closing dialog`, dialog.id);\n\n    // click that launched a dialog shouldn't also remove it\n    const createdAt = dialog.getAttribute('data-created');\n    if ((Date.now() - createdAt) < 500) {\n        if (debug) console.debug(`    cancelled because it's less than a second old`);\n        return;\n    }\n\n    if (debug) console.debug(`    dialog is ${Date.now() - createdAt} mS old`);\n\n    const relatedModal = getRelatedModal(dialog);\n\n    // close dialog animation\n    const animeConfig = {\n        targets: dialog,\n        translateX: [\n            { value: [ '-50%', '-50%' ] }\n        ],\n        translateY: [\n            { value: [ '-50%', '-50%' ] }\n        ],\n        scale: [\n            { value: [ 1, 0 ] }\n        ],\n        opacity: [\n            { value: [ 1, 0 ] }\n        ],\n        duration: 300,\n        easing: 'linear'\n    };\n\n    anime(animeConfig).finished.then(() => {\n        dialog.remove();\n\n        if (relatedModal)\n            relatedModal.remove();\n    });\n\n}\n\n\nfunction getAllDialogs() {\n    return document.querySelectorAll('.dialog-box');\n}\n\nfunction getAllModals() {\n    return document.querySelectorAll('.dialog-modal');\n}\n\nfunction getRelatedModal(dialog) {\n    return document.querySelector(`.dialog-modal[data-for=\"${dialog.id}\"]`);\n}\n\nfunction getRelatedDialog(modal) {\n    const dialogId = modal.getAttribute('data-for');\n    return document.getElementById(dialogId);\n}\n\n\n// setup dialog blur event detection once (on body element)\nlet blurHandlerBound = false;\nfunction initDialogListeners() {\n    if (blurHandlerBound)\n        return;\n\n    blurHandlerBound = true;\n\n    jQuery(document).on('click', (event) => {\n        const $clicked = jQuery(event.target);\n\n        if (debug) console.debug(`clicked on ${$clicked[0].nodeName} \"${$clicked.text().substring(0,10)}..\"`);\n\n        // interacting with a dialog only closes any later/on-top dialogs\n        const $closestDialogBox = $clicked.closest('.dialog-box');\n        if ($closestDialogBox.length) {\n            if (debug) console.debug(`  clicked on dialog`, $closestDialogBox[0].id);\n            const createdAt = $closestDialogBox[0].getAttribute('data-created');\n\n            getAllDialogs().forEach((dialog) => {\n                if (dialog.getAttribute('data-created') > createdAt)\n                    close(dialog);\n            });\n\n            if ($clicked.closest('.icon-close').length) {\n                if (debug) console.debug(`  clicked on dialog close button`);\n                close($closestDialogBox);\n            }\n\n            if ($clicked.closest('.icon-fullscreen').length) {\n                const url = $closestDialogBox.data('url');\n                if (debug) console.debug(`  clicked on dialog fullscreen button`, url);\n                window.open(url, '_self');\n            }\n\n            return;\n        }\n\n        // clicking on a modal overlay closes it, it's related dialog and all later/on-top dialogs/modals\n        const $closestModalOverlay = $clicked.closest('.dialog-modal');\n        if ($closestModalOverlay.length) {\n            const relatedDialog = getRelatedDialog($closestModalOverlay[0]);\n            if (relatedDialog) {\n                if (debug) console.debug(`  clicked on modal for dialog`, relatedDialog.id);\n\n                const createdAt = relatedDialog.getAttribute('data-created');\n\n                getAllDialogs().forEach((dialog) => {\n                    if (dialog.getAttribute('data-created') >= createdAt) {\n\n                        // persistent dialogs don't close on blur\n                        if (!dialog.classList.contains('persistent'))\n                            close(dialog);\n                    }\n                });\n            } else\n                if (debug) console.debug(`  clicked on a modal but it's related dialog is no longer in the DOM`);\n\n            return;\n        }\n\n        closeLast();    // click was not on a dialog or modal\n\n    }).on('keydown', (event) => {\n        if (debug) console.debug(`key pressed`, event.key);\n        if (event.key === 'Escape') {\n            // ESC on a form input first blurs the form - then closes the top dialog\n            if (document.activeElement && document.activeElement.nodeName !== \"BODY\") {\n                if (debug) console.debug(`blurring`, document.activeElement.nodeName);\n                document.activeElement.blur();\n            } else\n                closeLast();\n        }\n    });\n}\n\n\n\nfunction bindCloseCallback($dialog, callback) {\n\n// Create an observer instance linked to the callback function\n    const observer = new MutationObserver((mutationsList) => {\n        mutationsList.forEach((mutation) => {\n            mutation.removedNodes.forEach((node) => {\n                if ($dialog.is(jQuery(node))) {\n                    if (debug) console.debug('dialog removed:', node);\n                    executeCallback(callback);\n                }\n            });\n        });\n    });\n\n// Start observing the target node for configured mutations\n    observer.observe(document.querySelector('body'), { childList: true, subtree: true });\n}\n\n\n\n\nfunction elementTitle(element) {\n    if (element instanceof jQuery)\n        return element[0].title || element.data('title') || '';\n    else\n        return element.title || jQuery(element).data('title') || '';\n}\n\n\n\nconst usageInstructions = `Usage instructions for developers: \n<pre style=\"color:#888; font-size: 12px;\">\noptions object {\n    title:      string              dialog title or source element title attribute\n    source:     string | object     the content source: html content, selector, url, or element\n    fragment:   selector            selector by which to isolate a portion of the source HTML\n    modal:      boolean             page background dimming\n    iframe:     boolean             if the source is a url, whether to load it in an iFrame\n    replace:    boolean             whether to close any existing dialogs or layer up\n    persistent: boolean             whether ESC/blur automatically closes the dialog\n    onClose:    function | string   callback function or eval(string) to execute after dialog dismissed\n    classes:    string              classes to apply to the dialog container element\n    attributes: string              attributes to apply to the dialog container element eg. 'data-ignore-events=\"true\"'\n}\n</pre>\n\n<pre style=\"color: royalblue;  font-size: 12px;\">\ndialog.open(options).then(function() {\n    console.log('dialog launched');\n});\n</pre>`;\n\n\nexport { open, close, closeLast, closeAll };"],"names":["debug","loadUrlBusy","dialogCount","$body","$window","open","async","options","console","undefined","window","jQuery","default","anime","domUtils","$cache","title","source","usageInstructions","existingDialogs","document","querySelectorAll","length","forEach","dialog","count","parseInt","id","replace","log","dialogBody","dialogId","dialogTitle","sourceIsUrl","test","useIframe","iframe","sourceElement","querySelector","innerHTML","elementTitle","error","closeAll","modalDiv","modal","urlData","fullscreenUrl","createdData","Date","now","fullScreenIcon","fullscreenIcon","classes","push","persistent","attributes","$dialog","join","closeIcon","appendTo","onTop","onTopZIndex","$modal","css","find","initDialogListeners","onClose","bindCloseCallback","openAnimation","openAnimateDialog","warn","remove","setTimeout","$progressBar","ajax","url","xhr","XMLHttpRequest","addEventListener","evt","lengthComputable","loadProgress","loaded","total","fragment","html","includes","addClass","responseText","statusText","Promise","r","pause","finished","fadeIn","dialogWidth","width","dialogArea","height","windowWidth","windowArea","large","formInput","focus","select","wide","easing","animeConfig","targets","translateX","translateY","scale","duration","executeCallback","callback","eval","dialogs","getAllDialogs","modals","getAllModals","closeLast","lastDialog","classList","contains","close","closest","createdAt","getAttribute","relatedModal","getRelatedModal","value","opacity","then","getRelatedDialog","getElementById","blurHandlerBound","on","event","$clicked","target","nodeName","text","substring","$closestDialogBox","data","$closestModalOverlay","relatedDialog","key","activeElement","blur","MutationObserver","mutationsList","mutation","removedNodes","node","is","observe","childList","subtree","element"],"sourceRoot":""}