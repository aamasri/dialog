/*!
 * 
 *  dialog-js package version 1.0.0
 *  (c) 2020 Ananda Masri
 *  Released under the MIT license
 *  auroraweb.ca/giving-back/dialog-js
 *  
 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"open",(function(){return open})),__webpack_require__.d(__webpack_exports__,"closeAll",(function(){return closeAll})),__webpack_require__.d(__webpack_exports__,"closeLast",(function(){return closeLast}));var _dialog_styl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_dialog_styl__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_dialog_styl__WEBPACK_IMPORTED_MODULE_0__),_close_icon_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_close_icon_svg__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_close_icon_svg__WEBPACK_IMPORTED_MODULE_1__),_fullscreen_icon_svg__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_fullscreen_icon_svg__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_fullscreen_icon_svg__WEBPACK_IMPORTED_MODULE_2__);const busy={start:()=>{},stop:()=>{}},debug=!1;let loadUrlBusy,dialogCount=0,$body,$window;async function open(e){var o;e=e||{},debug&&console.debug("dialog.open invoked with options",e),void 0===window.jQuery&&(window.jQuery=await __webpack_require__.e(4).then(__webpack_require__.t.bind(null,5,7)),window.jQuery=window.jQuery.default),debug&&console.log("jQuery loaded",typeof window.jQuery),void 0===window.anime&&(window.anime=await __webpack_require__.e(3).then(__webpack_require__.bind(null,6)),window.anime=window.anime.default),debug&&console.log("animejs loaded",typeof window.anime);const t=await __webpack_require__.e(1).then(__webpack_require__.bind(null,7));debug&&console.log("dom-utils loaded",typeof t),$body=$body||t.$cache().$body,$window=$window||t.$cache().$window;let l,n="dialog-js-"+ ++dialogCount,c=e.title||"";const a="string"==typeof e.source&&(/^https?:\/\/[a-z]+/.test(e.source)||/^\/[a-z]+/.test(e.source));let s=e.iframe&&a||!1;if(s&&(l=`<iframe src="${e.source}"></iframe>`),!a){debug&&console.log("not url");try{const o=document.querySelector(e.source);console.log("source is an element"),o&&(l=o.innerHTML,c=c||elementTitle(o)||""),console.log(`dialog title:${c} \n\n body:${l}`)}catch(o){debug&&console.log(`source "${e.source}" is not a selector`)}c=c||e.title||"Missing Title",l=l||e.source||usageInstructions}e.replace=null===(o=e.replace)||void 0===o||o,e.replace&&closeAll();const i=e.modal?`<div class="dialog-js-modal" data-for="${n}"></div>`:"",r=s?"has-iframe":"",d=s?`data-url="${e.source}"`:"",_=`data-created="${Date.now()}"`,u=s?`<span class="icon-fullscreen" title="Fullscreen">${_fullscreen_icon_svg__WEBPACK_IMPORTED_MODULE_2___default.a}</span>`:"";let g=jQuery(`${i}\n                            <div id="${n}" class="dialog-js-box ${r}" ${_} ${d}>\n                                <div class="dialog-js-header">\n                                    <div class="title">${c}</div>\n                                    <div class="icons">\n                                        ${u}\n                                        <span class="icon-close" title="Close">${_close_icon_svg__WEBPACK_IMPORTED_MODULE_1___default.a}</span>\n                                    </div>\n                                </div>\n                                \n                                <div class="dialog-js-body">\n                                    ${l||"Loading..."}\n                                </div>\n                            </div>`);g.appendTo($body),e.modal&&(g=$body.find("#"+n)),debug&&console.log(`dialog ${n} appended to body`,g.length);const b=g.width(),p=g.height()*b,w=$window.width(),f=p/($window.height()*w)>.5,h=t.onTopZIndex();f&&g.addClass("large"),h&&g.css("z-index",h+1);const y=g.find(".dialog-js-body input");y.length&&y[0].focus().select(),initDialogListeners(),e.onClose&&bindCloseCallback(g,e.onClose);const v=b/w>.8?"cubicBezier(0.190, 1.000, 0.400, 1.000)":"easeOutElastic(1, 0.6)",m=a?1e3:500,k={targets:g[0],translateX:[{value:["-50%","-50%"]}],translateY:[{value:["-50%","-50%"]}],scale:[{value:[0,1]}],duration:m,easing:v},E=anime(k).finished;if(a&&!s){if(loadUrlBusy)return;loadUrlBusy=window.setTimeout((function(){loadUrlBusy=!1}),5e3),busy.start("dialog.open "+n);try{l=await jQuery.get(e.source),l=e.fragment?jQuery(l).find(e.fragment).html():l,l.includes("<head")&&(l=`<iframe src="${e.source}"></iframe>`,s=!0)}catch(o){l=o.responseText?o.responseText:o.statusText?`Loading url ${e.source} failed with "${o.statusText}"`:"Loading url ${options.source} failed!"}busy.stop("dialog.open "+n),loadUrlBusy=!1,g.find(".dialog-js-body").html(l),console.debug("replace content:",g.find(".dialog-js-body").html()),debug&&console.debug("remotely loaded content:",l)}await E}function executeCallback(callback){switch(typeof callback){case"function":return void callback();case"string":try{eval(callback)}catch(e){console.error("close callback failed with",error)}}}function closeAll(){const e=getAllDialogs(),o=getAllModals();e.length&&e.forEach(e=>{e.remove()}),o.length&&o.forEach(e=>{e.remove()})}function closeLast(){const e=getAllDialogs();e.length&&closeDialog(e[e.length-1])}function closeDialog(e){const o=jQuery(e);e=o[0],debug&&console.log("  closing dialog",e.id);const t=e.getAttribute("data-created");if(Date.now()-t<1e3)return void(debug&&console.log("    cancelled because it's less than a second old"));debug&&console.log(`    dialog is ${Date.now()-t} mS old`);const l=getRelatedModal(e);anime({targets:e,translateX:[{value:["-50%","-50%"]}],translateY:[{value:["-50%","-50%"]}],scale:[{value:[1,0]}],opacity:[{value:[1,0]}],duration:300,easing:"linear"}).finished.then(()=>{e.remove(),l&&l.remove()})}function getAllDialogs(){return document.querySelectorAll(".dialog-js-box")}function getAllModals(){return document.querySelectorAll(".dialog-js-modal")}function getRelatedModal(e){return document.querySelector(`.dialog-js-modal[data-for="${e.id}"]`)}function getRelatedDialog(e){const o=e.getAttribute("data-for");return document.getElementById(o)}let blurHandlerBound=!1;function initDialogListeners(){blurHandlerBound||(blurHandlerBound=!0,jQuery(document).on("click",e=>{const o=jQuery(e.target);debug&&console.log(`clicked on ${o[0].nodeName} "${o.text().substring(0,10)}.."`);const t=o.closest(".dialog-js-box");if(t.length){debug&&console.log("  clicked on dialog",t[0].id);const e=t[0].getAttribute("data-created");if(getAllDialogs().forEach(o=>{o.getAttribute("data-created")>e&&closeDialog(o)}),o.closest(".icon-close").length&&(debug&&console.log("  clicked on dialog close button"),closeDialog(t)),o.closest(".icon-fullscreen").length){const e=t.data("url");debug&&console.log("  clicked on dialog fullscreen button",e),window.open(e,"_self")}return}const l=o.closest(".dialog-js-modal");if(l.length){const e=getRelatedDialog(l[0]);debug&&console.log("  clicked on modal for dialog",e.id);const o=e.getAttribute("data-created");getAllDialogs().forEach(e=>{e.getAttribute("data-created")>=o&&closeDialog(e)})}else closeLast()}).on("keydown",e=>{debug&&console.log("key pressed",e.key),"Escape"===e.key&&(debug&&console.log("ESCAPE key pressed"),e.preventDefault(),e.stopPropagation(),closeLast())}))}function bindCloseCallback(e,o){new MutationObserver((t,l)=>{t.forEach(t=>{t.removedNodes.forEach(t=>{e.is(jQuery(t))&&(console.log("dialog removed:",t),executeCallback(o))})})}).observe(document.querySelector("body"),{childList:!0})}function elementTitle(e){return e instanceof jQuery?e[0].title||e.data("title")||"":e.title||jQuery(e).data("title")||""}const usageInstructions='Whoops Missing Content!<br><br>\nDialog-js usage cheatsheet (for the developer:)<br>\n<pre style="color:#888; font-size: 12px;">\noptions object {\n    source:     string | object     the content source: html content, selector, url, or element\n    fragment:   selector            selector by which to isolate a portion of the source HTML\n    title:      string              dialog title or source element title attribute\n    modal:      boolean             page background dimming\n    iframe:     boolean             if the source is a url, whether to load it in an iFrame\n    replace:    boolean             whether to close any existing dialogs or layer up\n    onClose:    function | string   callback function or eval(string) to execute after dialog dismissed\n}\n</pre>\n\n<pre style="color: royalblue;  font-size: 12px;">\ndialog.open(options).then(function() {\n    console.log(\'dialog launched\');\n});\n</pre>'},function(e,o,t){},function(e,o){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="28 28 116 116"><path d="M35.76335,28.59668c-2.91628,0.00077 -5.54133,1.76841 -6.63871,4.47035c-1.09737,2.70194 -0.44825,5.79937 1.64164,7.83336l45.09961,45.09961l-45.09961,45.09961c-1.8722,1.79752 -2.62637,4.46674 -1.97164,6.97823c0.65473,2.51149 2.61604,4.4728 5.12753,5.12753c2.51149,0.65473 5.18071,-0.09944 6.97823,-1.97165l45.09961,-45.09961l45.09961,45.09961c1.79752,1.87223 4.46675,2.62641 6.97825,1.97168c2.5115,-0.65472 4.47282,-2.61605 5.12755,-5.12755c0.65472,-2.5115 -0.09946,-5.18073 -1.97168,-6.97825l-45.09961,-45.09961l45.09961,-45.09961c2.11962,-2.06035 2.75694,-5.21064 1.60486,-7.93287c-1.15207,-2.72224 -3.85719,-4.45797 -6.81189,-4.37084c-1.86189,0.05548 -3.62905,0.83363 -4.92708,2.1696l-45.09961,45.09961l-45.09961,-45.09961c-1.34928,-1.38698 -3.20203,-2.16948 -5.13704,-2.1696z"></path></svg>'},function(e,o){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="21 21 130 130"><path d="M35.83333,21.5c-7.83362,0 -14.33333,6.49972 -14.33333,14.33333v21.5c-0.03655,2.58456 1.32136,4.98858 3.55376,6.29153c2.2324,1.30295 4.99342,1.30295 7.22582,0c2.2324,-1.30295 3.59031,-3.70697 3.55376,-6.29153v-21.5h21.5c2.58456,0.03655 4.98858,-1.32136 6.29153,-3.55376c1.30295,-2.2324 1.30295,-4.99342 0,-7.22582c-1.30295,-2.2324 -3.70697,-3.59031 -6.29153,-3.55376zM114.66667,21.5c-2.58456,-0.03655 -4.98858,1.32136 -6.29153,3.55376c-1.30295,2.2324 -1.30295,4.99342 0,7.22582c1.30295,2.2324 3.70697,3.59031 6.29153,3.55376h21.5v21.5c-0.03655,2.58456 1.32136,4.98858 3.55376,6.29153c2.2324,1.30295 4.99342,1.30295 7.22582,0c2.2324,-1.30295 3.59031,-3.70697 3.55376,-6.29153v-21.5c0,-7.83362 -6.49972,-14.33333 -14.33333,-14.33333zM28.55469,107.40202c-3.95253,0.06178 -7.10882,3.312 -7.05469,7.26465v21.5c0,7.83362 6.49972,14.33333 14.33333,14.33333h21.5c2.58456,0.03655 4.98858,-1.32136 6.29153,-3.55376c1.30295,-2.2324 1.30295,-4.99342 0,-7.22582c-1.30295,-2.2324 -3.70697,-3.59031 -6.29153,-3.55376h-21.5v-21.5c0.02653,-1.93715 -0.73227,-3.80254 -2.10349,-5.17112c-1.37122,-1.36858 -3.23806,-2.12378 -5.17516,-2.09353zM143.22135,107.40202c-3.95253,0.06178 -7.10882,3.312 -7.05469,7.26465v21.5h-21.5c-2.58456,-0.03655 -4.98858,1.32136 -6.29153,3.55376c-1.30295,2.2324 -1.30295,4.99342 0,7.22582c1.30295,2.2324 3.70697,3.59031 6.29153,3.55376h21.5c7.83362,0 14.33333,-6.49972 14.33333,-14.33333v-21.5c0.02653,-1.93715 -0.73227,-3.80254 -2.10349,-5.17112c-1.37122,-1.36858 -3.23806,-2.12378 -5.17516,-2.09353z"></path></svg>'}]]);